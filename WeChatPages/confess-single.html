<!DOCTYPE html>
<html lang="en">

<head>
    <title>上财微助手</title>
    <meta charset="UTF-8">
    <meta name="description" content="Your description">
    <meta name="keywords" content="Your Keywords">
    <meta name="author" content="Author Name">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, minimum-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black">
    <link rel="stylesheet" href="css/bootstrap.min.css">
    <link rel="stylesheet" href="css/font-awesome.min.css">
    <link rel="stylesheet" href="css/bootstrap-datetimepicker.min.css">
    <link rel="stylesheet" href="css/reset.css">
    <link rel="stylesheet" href="css/theme.css">
    <!--Custom CSS-->
    <link rel="stylesheet" href="css/confess.css">
    <!--[if lt IE 9]>
    <script src="http://cdn.bootcss.com/html5shiv/3.7.0/html5shiv.min.js"></script>
    <script src="http://cdn.bootcss.com/respond.js/1.3.0/respond.min.js"></script>
    <![endif]-->
</head>

<body class="body-confess-single">
    <div class="inner-page confess-single">
        <div class="container">
            <div class="row">
                <div class="col-sm-6 col-sm-offset-3 col-md-8 col-md-offset-2">
                    <div class="box br-red">
                        <div class="to">
                            To:xxx
                        </div>
                        <div class="content">
                            <p>我好喜欢你~</p>
                        </div>
                    </div>
                </div>
            </div>
            <div class="row">
                <div class="col-sm-6 col-sm-offset-3 col-md-8 col-md-offset-2">
                    <div class="btn-container">
                        <div class="container">
                            <div class="row">
                                <div class="col col-xs-7">
                                    <strong class="pink">感动 , </strong>
                                    <span class="pink">我要</span>
                                    <button id="like-it" class="btn bg-pink">为爱助力</button>
                                </div>
                                <div class="col col-xs-5">
                                    <div class="heart-bar">
                                        <div class="bar">
                                            <div class="heart" data-count="3" data-max="10">
                                                <i class="fa fa-heart"></i>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            </div>
                            <div class="row">
                                <div class="col col-xs-7">
                                    <strong class="light-blue">别吵 , </strong>
                                    <span class="light-blue">我来</span>
                                    <button id="say-something" class="btn bg-light-blue">说几句</button>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
            <div class="row">
                <div class="col-sm-6 col-sm-offset-3 col-md-8 col-md-offset-2">
                    <div class="tab-wrapper">
                        <div class="inner-tab">
                            <div class="reply-tab">
                                <ul>
                                    <li>
                                        <p>哈哈哈哈哈哈</p>
                                    </li>
                                    <li>
                                        <p>呵呵呵呵呵呵呵呵</p>
                                    </li>
                                    <li>
                                        <p>嘻嘻嘻嘻嘻嘻嘻</p>
                                    </li>
                                    <li>
                                        <p>嘿嘿嘿嘿嘿嘿嘿嘿嘿嘿嘿嘿嘿嘿嘿嘿嘿嘿嘿嘿嘿嘿嘿嘿</p>
                                    </li>
                                </ul>
                            </div>
                            <div class="publish-tab">
                                <textarea class="form-control"></textarea>
                                <button id="send" class="btn btn-block"><i class="fa fa-paper-plane"></i> 匿名发送</button>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
    <script src="js/jquery-1.11.1.min.js"></script>
    <script src="js/bootstrap.min.js"></script>
    <script type="text/javascript">
    $(function() {
        // tab-wrapper自适应
        resizeTabHeight();
        $(window).resize(function(event) {
            resizeTabHeight();
        });

        function resizeTabHeight() {
                var h = $(window).height();
                var h1 = $('.confess-single>.container>.row').eq(0).outerHeight();
                var h2 = $('.confess-single>.container>.row').eq(1).outerHeight();
                $('.tab-wrapper').outerHeight(h - h1 - h2-15);
            }
        //聊天框效果
        var $posts = $('.inner-tab ul li');
        var max_width = $('.inner-tab').outerWidth();
        var word_width = 14;
        $posts.each(function() {
            var words_len = $.trim($(this).text()).length;
            var min_width = word_width * words_len + 16;
            if (min_width <= max_width) {
                var max_margin = max_width - min_width;
                var rand_margin = rd(0, max_margin);
                if (rand_margin + min_width / 2 < max_width / 2) {
                    $(this).addClass('angle-left');
                } else {
                    $(this).addClass('angle-right');
                }
                $(this).outerWidth(min_width).css('margin-left', rand_margin + 'px');
            } else {
                var rand_width = rd(180, max_width);
                var max_margin = max_width - rand_width;
                var rand_margin = rd(0, max_margin);
                if (rand_margin + rand_width / 2 < max_width / 2) {
                    $(this).addClass('angle-left');
                } else {
                    $(this).addClass('angle-right');
                }
                $(this).outerWidth(rand_width).css('margin-left', rand_margin + 'px');
            }
        })
        // 初始化爱心
        var $bar=$('.heart-bar .bar');
        var $heart=$('.heart-bar .heart');
        var max_count=$heart.data('max');
        var like_count=$heart.data('count');
        function initHeart(){
            var bar_width=$bar.width();
            var l_bound=-10;
            var r_bound=bar_width-27;
            if(like_count<=max_count){
                var offset=l_bound+(r_bound-l_bound)*like_count/max_count;
                $heart.animate({
                    'left': offset+'px'},
                    1000);
            }
        } 
        initHeart();
        // 为爱助力
        var hasLiked=0;
        $('#like-it').click(function() {
            if(!hasLiked){
                $heart.attr('data-count',++like_count);
                hasLiked=1;
                initHeart();
            }else{
                alert('你已经赞过了哦~');
            }
        });
        // 说几句
        $('#say-something').click(function() {
            var $this=$(this);
            if($this.hasClass('active')){
                $('.reply-tab').fadeIn('slow',function(){
                    $this.removeClass('active');
                    $this.siblings('strong').text('别吵 , ');
                    $this.siblings('span').text('我来');
                    $this.text('说几句'); 
                });             
            }else{
            $('.reply-tab').fadeOut('slow',function(){
                $this.addClass('active');
                $this.siblings('strong').text('算了 , ');
                $this.siblings('span').text('我要');
                $this.text('看评论');
                $('.publish-tab textarea').focus();
            });
            }
        });
        $('#send').click(function() {
            //$.post('',{},function(){})
            $('#say-something').removeClass('active');
            $('.reply-tab').fadeIn('slow');
        });
        //生成n,m间的随机整数
        function rd(n, m) {
            var c = m - n + 1;
            return Math.floor(Math.random() * c + n);
        }
    })
    </script>
</body>

</html>
