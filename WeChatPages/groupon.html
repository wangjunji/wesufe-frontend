<!DOCTYPE html>
<html lang="en">

<head>
    <title>上财微助手</title>
    <meta charset="UTF-8">
    <meta name="description" content="Your description">
    <meta name="keywords" content="Your Keywords">
    <meta name="author" content="Author Name">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, minimum-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black">
    <link rel="stylesheet" href="css/bootstrap.min.css">
    <link rel="stylesheet" href="css/font-awesome.min.css">
    <link rel="stylesheet" href="css/reset.css">
    <link rel="stylesheet" href="css/theme.css">
    <!--Custom CSS-->
    <link rel="stylesheet" href="css/jquery.fancybox.css">
    <link rel="stylesheet" href="css/groupon.css">
    <!--[if lt IE 9]>
        <script src="http://cdn.bootcss.com/html5shiv/3.7.0/html5shiv.min.js"></script>
        <script src="http://cdn.bootcss.com/respond.js/1.3.0/respond.min.js"></script>
    <![endif]-->
</head>

<body>
    <div class="navbar navbar-default navbar-fixed-top">
        <a class="navbar-brand" href="#"><i class="fa fa-cutlery"></i> 美食团购</a>
        <a id="filter" class="filter pull-right" href="#"><i class="fa fa-bars"></i></a>
        <div class="dropdown" style="display:none">
            <div class="filter-type">
                <div class="item">
                    <a id="filter-district" class="active" href="#">
                        <span id="district-select">全部商区</span><i class="fa fa-angle-down"></i>
                        <input type="hidden" name="latitude" id="latitude">
                        <input type="hidden" name="longitude" id="longitude">
                    </a>
                </div>
                <div class="item">
                    <a id="filter-category" href="#">
                        <span id="category-select">全部分类</span> <i class="fa fa-angle-down fa-rotate-180"></i>
                    </a>
                </div>
            </div>
            <div id="search-area">
                <div class="search level-1">
                    <ul>
                        <li id="filter-all">
                        </li>
                    </ul>
                </div>
                <div class="search level-2">
                    <ul>
                    </ul>
                </div>
            </div>
        </div>
    </div>
    <div class="inner-page groupon">
        <div class="container-fluid">
            <div class="container container-pad" id="property-listings">
                <div class="row">
                    <div class="col-sm-12">
                        <div class="brdr bgc-fff pad-10 box-shad btm-mrg-20 property-listing">
                            <div class="media">
                                <div class="img-box pull-left">
                                    <a href="#" target="_parent">
                                        <img alt="image" class="img-responsive" src="http://t3.s2.dpfile.com/pc/mc/e75efd4b642251e21af2691a9df77399(450x1024)/thumb.jpg">
                                    </a>
                                    <div class="desc">Le Camelia法式浪漫拿破仑</div>
                                </div>
                                <div class="clearfix visible-xs"></div>
                                <div class="media-body fnt-smaller">
                                    <a href="#" target="_parent"></a>
                                    <h4 class="media-heading">
                                        <span class="discount">￥138</span>
                                        <del class="original">238</del>
                                    </h4>
                                    <div class="shop">
                                        <strong>Le Camelia(月星环球港店)</strong>
                                    </div>
                                    <p class="fnt-smaller fnt-lighter fnt-arial">仅售138元,价值238元法式浪漫拿破仑1个!2店通用!月星环球港新店开业!法式甜品经典,三十多层香脆起酥皮,融合清新奶油,口感层次丰富,幸福甜蜜妙不可言!
                                    </p>
                                </div>
                            </div>
                        </div>
                        <div class="brdr bgc-fff pad-10 box-shad btm-mrg-20 property-listing">
                            <div class="media">
                                <div class="img-box pull-left">
                                    <a href="#" target="_parent">
                                        <img alt="image" class="img-responsive" src="http://t3.s2.dpfile.com/pc/mc/e75efd4b642251e21af2691a9df77399(450x1024)/thumb.jpg">
                                    </a>
                                    <div class="desc">Le Camelia法式浪漫拿破仑</div>
                                </div>
                                <div class="clearfix visible-xs"></div>
                                <div class="media-body fnt-smaller">
                                    <a href="#" target="_parent"></a>
                                    <h4 class="media-heading">
                                        <span class="discount">￥138</span>
                                        <del class="original">238</del>
                                    </h4>
                                    <div class="shop">
                                        <strong>Le Camelia(月星环球港店)</strong>
                                    </div>
                                    <p class="fnt-smaller fnt-lighter fnt-arial">仅售138元,价值238元法式浪漫拿破仑1个!2店通用!月星环球港新店开业!法式甜品经典,三十多层香脆起酥皮,融合清新奶油,口感层次丰富,幸福甜蜜妙不可言!
                                    </p>
                                </div>
                            </div>
                        </div>
                        <div class="brdr bgc-fff pad-10 box-shad btm-mrg-20 property-listing">
                            <div class="media">
                                <div class="img-box pull-left">
                                    <a href="#" target="_parent">
                                        <img alt="image" class="img-responsive" src="http://t3.s2.dpfile.com/pc/mc/e75efd4b642251e21af2691a9df77399(450x1024)/thumb.jpg">
                                    </a>
                                    <div class="desc">Le Camelia法式浪漫拿破仑</div>
                                </div>
                                <div class="clearfix visible-xs"></div>
                                <div class="media-body fnt-smaller">
                                    <a href="#" target="_parent"></a>
                                    <h4 class="media-heading">
                                        <span class="discount">￥138</span>
                                        <del class="original">238</del>
                                    </h4>
                                    <div class="shop">
                                        <strong>Le Camelia(月星环球港店)</strong>
                                    </div>
                                    <p class="fnt-smaller fnt-lighter fnt-arial">仅售138元,价值238元法式浪漫拿破仑1个!2店通用!月星环球港新店开业!法式甜品经典,三十多层香脆起酥皮,融合清新奶油,口感层次丰富,幸福甜蜜妙不可言!
                                    </p>
                                </div>
                            </div>
                        </div>
                        <div class="brdr bgc-fff pad-10 box-shad btm-mrg-20 property-listing">
                            <div class="media">
                                <div class="img-box pull-left">
                                    <a href="#" target="_parent">
                                        <img alt="image" class="img-responsive" src="http://t3.s2.dpfile.com/pc/mc/e75efd4b642251e21af2691a9df77399(450x1024)/thumb.jpg">
                                    </a>
                                    <div class="desc">Le Camelia法式浪漫拿破仑</div>
                                </div>
                                <div class="clearfix visible-xs"></div>
                                <div class="media-body fnt-smaller">
                                    <a href="#" target="_parent"></a>
                                    <h4 class="media-heading">
                                        <span class="discount">￥138</span>
                                        <del class="original">238</del>
                                    </h4>
                                    <div class="shop">
                                        <strong>Le Camelia(月星环球港店)</strong>
                                    </div>
                                    <p class="fnt-smaller fnt-lighter fnt-arial">仅售138元,价值238元法式浪漫拿破仑1个!2店通用!月星环球港新店开业!法式甜品经典,三十多层香脆起酥皮,融合清新奶油,口感层次丰富,幸福甜蜜妙不可言!
                                    </p>
                                </div>
                            </div>
                        </div>
                    </div>
                    <!-- End Col -->
                </div>
                <!-- End row -->
            </div>
            <!-- End container -->
        </div>
    </div>
    <div class="fixed-bottom footer">
        2014 &copy; WeSufe
    </div>
    <script src="js/jquery-1.11.1.min.js"></script>
    <script src="js/bootstrap.min.js"></script>
    <script type="text/javascript">
    //过滤菜单切换
    $('#filter').click(function() {
        $(this).toggleClass('active');
        $('.dropdown').fadeToggle('fast');
    });
    $('#filter-district').click(function() {
        $(this).toggleClass('active');
        $(this).find('i').toggleClass('fa-rotate-180');
        if ($('#filter-category').hasClass('active')) {
            $('#filter-category').removeClass('active');
            $('#filter-category').find('i').toggleClass('fa-rotate-180');
        } else {
            $('#search-area').fadeIn('fast');
        }
        if ($(this).hasClass('active')) {
            initLayout("district");
        } else {
            $('#search-area').fadeOut('fast');
        }
    });
    $('#filter-category').click(function() {
            $(this).toggleClass('active');
            $(this).find('i').toggleClass('fa-rotate-180');
            if ($('#filter-district').hasClass('active')) {
                $('#filter-district').removeClass('active');
                $('#filter-district').find('i').toggleClass('fa-rotate-180');
            } else {
                $('#search-area').fadeIn('fast');
            }
            if ($(this).hasClass('active')) {
                initLayout("category");
            } else {
                $('#search-area').fadeOut('fast');
            }
        })
        //一级菜单
    var cities = initDistirctData();
    var categories = initCategoryData();
    initLayout("district");
    //读取商区数据
    function initDistirctData() {
            var cities = {};
            $.ajax({
                url: 'js/district-regions.json',
                type: 'GET',
                dataType: 'json',
                async: false,
                success: function(data) {
                    cities = data;
                }
            })
            return cities;
        }
        //读取分类数据
    function initCategoryData() {
            var categories = {};
            $.ajax({
                url: 'js/category.json',
                type: 'GET',
                dataType: 'json',
                async: false,
                success: function(data) {
                    categories = data;
                }
            })
            return categories;
        }
        //加载过滤列表
    function initLayout(type) {
            var html = "";
            if (type === "district") {
                $('#filter-all').html('<a data-link="area" href="#">全部商区</a>');
                $('#filter-all a').bind('click',liClick)
                $.each(cities.districts, function(index, val) {
                    html += '<li><a href="javascript:loadArea(\'' + val.district_name + '\')">' + val.district_name + '</a></li>'
                });
                $('.level-1 ul li').not(':first').remove();
                $('.level-1 ul').append(html);
                $('.level-1 ul li').not(':first').bind('click', function() {
                    $(this).addClass('active');
                    $(this).siblings().removeClass('active');
                })
            } else if (type === "category") {
                $('#filter-all').html('<a data-link="category" href="#">全部分类</a>');
                $('#filter-all a').bind('click',liClick)
                $.each(categories, function(index, val) {
                    if (val.subcategories.length > 0) {
                        html += '<li><a href="javascript:loadSubcategory(\'' + val.category_name + '\')">' + val.category_name + '</a></li>'
                    } else {
                        html += '<li><a data-link="category" href="#">' + val.category_name + '</a></li>'
                    }
                });
                $('.level-1 ul li').not(':first').remove();
                $('.level-1 ul').append(html);
                $('.level-1 ul li').not(':first').bind('click', function() {
                    $(this).addClass('active');
                    $(this).siblings().removeClass('active');
                })
            }
        }
        //加载商区
    function loadArea(districtName) {
            var html = ""
            $.each(cities.districts, function(index, val) {
                if (val.district_name == districtName) {
                    $.each(val.neighborhoods, function(index, val) {
                        html += '<li><a data-link="area" data-coordinate="' + val.coordinate + '" href="#">' + val.name + '</a></li>'
                    });
                    $('.level-2 ul').empty();
                    $('.level-2 ul').append(html);
                    $('.level-2 ul li a').bind('click',liClick);
                    return false;
                }
            });
        }
        //加载子分类
    function loadSubcategory(categoryName) {
        var html = ""
        $.each(categories, function(index, val) {
            if (val.category_name == categoryName) {
                $.each(val.subcategories, function(index, val) {
                    html += '<li><a data-link="category" href="#">' + val + '</a></li>'
                });
                $('.level-2 ul').empty();
                $('.level-2 ul').append(html);
                $('.level-2 ul li a').bind('click',liClick);
                return false;
            }
        });
    }
    //点击事件
    function liClick(e){
        e.preventDefault();
        $('#latitude').val('');
        $('#longitude').val('');
        var link=$(this).data('link');
        if(link=="area"){
            var coordinate=$(this).data('coordinate');
            $('#district-select').html($(this).text());
            if(coordinate){
                var latitude=coordinate.split(",")[0];
                var longitude=coordinate.split(",")[1];
                $('#latitude').val(latitude);
                $('#longitude').val(longitude);
            }
        }else if(link=="category"){
            $('#category-select').html($(this).text());
        }
        resetLayout();
        loadGroupon();        
    }
    //重置界面
    function resetLayout(){
        $('#search-area').fadeOut();
        $('#filter-district i,#filter-category i').addClass('fa-rotate-180');
        $('#filter-district,#filter-category').removeClass('active');
    }
    //读取团购
    function loadGroupon(){

    }
    </script>
</body>

</html>
