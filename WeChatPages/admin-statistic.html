<!DOCTYPE html>
<html lang="en">

<head>
    <title>上财微助手</title>
    <meta charset="UTF-8">
    <meta name="description" content="Your description">
    <meta name="keywords" content="Your Keywords">
    <meta name="author" content="Author Name">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, minimum-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black">
    <link rel="stylesheet" href="css/bootstrap.min.css">
    <link rel="stylesheet" href="css/font-awesome.min.css">
    <link rel="stylesheet" href="css/reset.css">
    <link rel="stylesheet" href="css/theme.css">
    <!--Custom CSS-->
    <link rel="stylesheet" href="css/bootstrap-datetimepicker.min.css">
    <link rel="stylesheet" href="plugins/dataTables/css/dataTables.bootstrap.css" />
    <link rel="stylesheet" href="css/admin.css">
    <!--[if lt IE 9]>
        <script src="http://cdn.bootcss.com/html5shiv/3.7.0/html5shiv.min.js"></script>
        <script src="http://cdn.bootcss.com/respond.js/1.3.0/respond.min.js"></script>
    <![endif]-->
</head>

<body>
    <nav class="navbar navbar-default navbar-fixed-top" role="navigation">
        <!-- Brand and toggle get grouped for better mobile display -->
        <div class="navbar-header">
            <button type="button" class="navbar-toggle" data-toggle="collapse" data-target=".navbar-ex1-collapse">
                <span class="sr-only">Toggle</span>
                <span class="icon-bar"></span>
                <span class="icon-bar"></span>
                <span class="icon-bar"></span>
            </button>
            <a class="navbar-brand" href="#">WeSufe后台管理系统</a>
        </div>
        <!-- Collect the nav links, forms, and other content for toggling -->
        <div class="collapse navbar-collapse navbar-ex1-collapse">
            <ul class="nav navbar-nav">
                <li class="active"><a href="#">用户管理</a>
                </li>
                <li><a href="#">活动讲座</a>
                </li>
            </ul>
            <ul class="nav navbar-nav navbar-right">
                <li><a href="#">柯鸿鹏</a>
                </li>
                <li class="dropdown">
                    <a href="#" class="dropdown-toggle" data-toggle="dropdown">操作 <b class="caret"></b></a>
                    <ul class="dropdown-menu">
                        <li><a href="#"><i class="fa fa-sign-out"></i> 退出</a>
                        </li>
                    </ul>
                </li>
            </ul>
        </div>
        <!-- /.navbar-collapse -->
    </nav>
    <div class="inner-page admin-statistic">
        <div class="container">
            <div class="row">
                <h3 class="page-header text-left">
                    接口流量统计
                    <small id="today"></small>
                    <div class="input-group date" id="datetimepicker">
                        <input id="time" type="text" class="form-control" placeholder="选择日期..." data-date-format="YYYY年MM月DD日">
                        <span class="input-group-addon">
                            <i class="fa fa-calendar"></i>
                        </span>
                    </div>
                </h3>
                <div class="col-sm-2">
                    <div class="panel panel-default">
                        <div class="panel-heading">
                            调用功能Top3
                        </div>
                        <div class="panel-body">
                            <ul>
                                <li>翻译
                                    <span>3次</span>
                                </li>
                                <li>团购
                                    <span>4次</span>
                                </li>
                                <li>火车
                                    <span>5次</span>
                                </li>
                            </ul>
                        </div>
                    </div>
                    <div class="panel panel-default">
                        <div class="panel-heading">
                            调用时段Top3
                        </div>
                        <div class="panel-body">
                            <ul>
                                <li>12-14
                                    <span>3次</span>
                                </li>
                                <li>20-22
                                    <span>3次</span>
                                </li>
                                <li>22-24
                                    <span>3次</span>
                                </li>
                            </ul>
                        </div>
                    </div>
                </div>
                <div class="col-sm-10">
                    <table id="statistic-table" class="table table-striped table-bordered table-hover" id="gpa-table">
                        <thead>
                            <tr>
                                <th nowrap>功能</th>
                                <th nowrap>00-02</th>
                                <th nowrap>00-06</th>
                                <th nowrap>06-08</th>
                                <th nowrap>08-10</th>
                                <th nowrap>10-12</th>
                                <th nowrap>12-14</th>
                                <th nowrap>14-16</th>
                                <th nowrap>16-18</th>
                                <th nowrap>18-20</th>
                                <th nowrap>20-22</th>
                                <th nowrap>22-00</th>
                                <th nowrap>总计</th>
                            </tr>
                        </thead>
                        <tbody>
                            <tr>
                                <td>活动</td>
                                <td>1</td>
                                <td>2</td>
                                <td>2</td>
                                <td>3</td>
                                <td>4</td>
                                <td>25</td>
                                <td>1</td>
                                <td>2</td>
                                <td>3</td>
                                <td>14</td>
                                <td>5</td>
                                <td></td>
                            </tr>
                            <tr>
                                <td>电影</td>
                                <td>1</td>
                                <td>2</td>
                                <td>3</td>
                                <td>4</td>
                                <td>5</td>
                                <td>1</td>
                                <td>2</td>
                                <td>3</td>
                                <td>2</td>
                                <td>34</td>
                                <td>5</td>
                                <td></td>
                            </tr>
                            <tr>
                                <td>团购</td>
                                <td>1</td>
                                <td>2</td>
                                <td>3</td>
                                <td>14</td>
                                <td>2</td>
                                <td>5</td>
                                <td>1</td>
                                <td>2</td>
                                <td>5</td>
                                <td>4</td>
                                <td>5</td>
                                <td></td>
                            </tr>
                            <tr>
                                <td>翻译</td>
                                <td>1</td>
                                <td>2</td>
                                <td>3</td>
                                <td>4</td>
                                <td>2</td>
                                <td>2</td>
                                <td>1</td>
                                <td>4</td>
                                <td>3</td>
                                <td>4</td>
                                <td>5</td>
                                <td></td>
                            </tr>
                            <tr>
                                <td>天气</td>
                                <td>1</td>
                                <td>2</td>
                                <td>5</td>
                                <td>4</td>
                                <td>5</td>
                                <td>1</td>
                                <td>4</td>
                                <td>3</td>
                                <td>4</td>
                                <td>2</td>
                                <td>5</td>
                                <td></td>
                            </tr>
                        </tbody>
                        <tfoot>
                            <th>总计</th>
                            <th></th>
                            <th></th>
                            <th></th>
                            <th></th>
                            <th></th>
                            <th></th>
                            <th></th>
                            <th></th>
                            <th></th>
                            <th></th>
                            <th></th>
                            <th></th>
                        </tfoot>
                    </table>
                </div>
            </div>
        </div>
    </div>
    <div class="modal fade" id="chart-modal">
        <div class="modal-dialog modal-lg">
            <div class="modal-content">
                <div class="modal-body">
                    <div id="line-chart"></div>
                </div>
            </div>
            <!-- /.modal-content -->
        </div>
        <!-- /.modal-dialog -->
    </div>
    <!-- /.modal -->
    <script src="js/jquery-1.11.1.min.js"></script>
    <script src="js/bootstrap.min.js"></script>
    <script src="js/moment.min.js"></script>
    <script src="js/highcharts.js"></script>
    <script src="js/bootstrap-datetimepicker.min.js"></script>
    <script src="js/zh-cn.js"></script>
    <script type="text/javascript" src="plugins/dataTables/jquery.dataTables.min.js"></script>
    <script type="text/javascript" src="plugins/dataTables/dataTables.bootstrap.js"></script>
    <script type="text/javascript">
    $(function() {
        //show date
        $('#today').html(new Date().toLocaleDateString());
        //DataTable Sum
        jQuery.fn.dataTable.Api.register('sum()', function() {
            return this.flatten().reduce(function(a, b) {
                return (a * 1) + (b * 1); // cast values in-case they are strings
            });
        });
        //row sum
        $('#statistic-table tbody tr').each(function() {
                var data = $(this).find('td');
                var sum = 0;
                for (var i = 1; i < data.size() - 1; i++) {
                    sum += parseInt(data.eq(i).text());
                }
                data.last().html(sum);
            })
            //init dataTable
        var table = $('#statistic-table').dataTable({
            "paging": false,
            "searching": false,
            "info": false,
            "language": {
                search: "<i class='fa fa-search'></i> 搜索:",
                lengthMenu: "每页显示 _MENU_ 个用户",
                zeroRecords: "没有记录",
                paginate: {
                    first: "第一页",
                    previous: "上一页",
                    next: "下一页",
                    last: "最后页"
                }
            },
            footerCallback: function(tfoot, data, start, end, display) {
                var api = this.api();
                var sum = 0;
                var series = [];
                var nCells = $(tfoot).find('th').size();
                for (var i = 1; i < nCells; i++) {
                    var subsum = api.column(i).data().sum();
                    sum += subsum;
                    $(api.column(i).footer()).html(subsum);
                }
                for (var i = 0; i < end; i++) {
                    var name = data[i][0];
                    var dataset=[];
                    for(var j=1;j<data[i].length-1;j++){
                        dataset.push(parseInt(data[i][j]));
                    }
                    var obj={};
                    obj.name=name;
                    obj.data=dataset;
                    series.push(obj);
                }
                $(tfoot).bind('click', function() {
                    $('#line-chart').highcharts({
                        chart: {
                            type: 'line'
                        },
                        title: {
                            text: date + "访问次数汇总" //指定图表标题
                        },
                        xAxis: {
                            categories: ['00-02', '02-06', '06-08', '08-10', '10-12', '12-14', '12-16', '16-18', '18-20', '20-22', '22-00'] //指定x轴
                        },
                        yAxis: {
                            title: {
                                text: '访问次数' //指定y轴的标题
                            }
                        },
                        series: series
                    });
                    $('#chart-modal').modal('show');
                })
            }
        });
        //init datetimepicker
        var dt = $('#datetimepicker').datetimepicker({
            icons: {
                time: "fa fa-clock-o",
                date: "fa fa-calendar",
                up: "fa fa-arrow-up",
                down: "fa fa-arrow-down"
            },
            language: "zh-cn"
        });

        var date = new Date().toLocaleDateString();
        $('#statistic-table tbody tr').bind('click', function() {
            var func = $(this).find('td:first').text();
            var $tds = $(this).find('td').not(':first').not(':last');
            var data = [];
            $tds.each(function() {
                data.push(parseInt($(this).text()));
            })
            $('#line-chart').highcharts({
                chart: {
                    type: 'line'
                },
                title: {
                    text: date + func + "访问次数" //指定图表标题
                },
                xAxis: {
                    categories: ['00-02', '02-06', '06-08', '08-10', '10-12', '12-14', '12-16', '16-18', '18-20', '20-22', '22-00'] //指定x轴
                },
                yAxis: {
                    title: {
                        text: '访问次数' //指定y轴的标题
                    }
                },
                series: [{ //指定数据列
                    name: func, //数据列名
                    data: data //数据
                }]
            });
            $('#chart-modal').modal('show');
        })
    })
    </script>
</body>

</html>
